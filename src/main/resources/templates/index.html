<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Upload Legal Document</title>
    <link rel="stylesheet" th:href="@{/css/style.css}" href="/css/style.css"/>
    <script>
        function showFileName(input) {
            const fileNameSpan = document.getElementById('file-name');
            if (input.files && input.files.length > 0) {
                fileNameSpan.textContent = "Selected file: " + input.files[0].name;
            } else {
                fileNameSpan.textContent = "";
            }
        }

        window.addEventListener('DOMContentLoaded', function() {
            const form = document.querySelector('form');
            const spinnerOverlay = document.getElementById('spinner-overlay');
            if (form) {
                form.addEventListener('submit', function() {
                    spinnerOverlay.style.display = 'flex';
                });
            }

            // Drag and drop logic
            const dropZone = document.getElementById('drop-zone');
            const fileInput = document.getElementById('file');
            const fileNameSpan = document.getElementById('file-name');

            if (dropZone && fileInput) {
                dropZone.addEventListener('click', function() {
                    fileInput.click();
                });

                dropZone.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    dropZone.classList.add('dragover');
                });

                dropZone.addEventListener('dragleave', function(e) {
                    e.preventDefault();
                    dropZone.classList.remove('dragover');
                });

                dropZone.addEventListener('drop', function(e) {
                    e.preventDefault();
                    dropZone.classList.remove('dragover');
                    if (e.dataTransfer.files && e.dataTransfer.files.length > 0) {
                        fileInput.files = e.dataTransfer.files;
                        showFileName(fileInput);
                    }
                });

                fileInput.addEventListener('change', function() {
                    showFileName(fileInput);
                });
            }

            // Modal logic
            const modal = document.getElementById('limit-modal');
            if (modal && modal.dataset.show === "true") {
                modal.style.display = 'flex';
            }
            const closeBtn = document.getElementById('close-modal-btn');
            if (closeBtn) {
                closeBtn.onclick = function() {
                    modal.style.display = 'none';
                }
            }
            window.onclick = function(event) {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            }
        });
    </script>
</head>
<body>
<div class="container">
    <h2>Upload Your Legal Document</h2>
    <div class="instructions">
        Please select a legal document file to simplify.<br>
        <strong>Accepted formats:</strong> PDF, DOCX.<br>
        Your file will be processed securely.
    </div>
    <form method="post" enctype="multipart/form-data" th:action="@{/upload}">
        <label for="file">Choose file:</label>
        <div id="drop-zone" class="drop-zone" tabindex="0" aria-label="Drag and drop your file here or click to select">
            Drag &amp; drop your file here or click to select
        </div>
        <input type="file" id="file" name="file" required accept=".pdf,.doc,.docx,.txt" style="display:none;"/>
        <div id="file-name" class="file-name"></div>
        <button type="submit">Simplify</button>
    </form>
</div>
<div class="spinner-overlay" id="spinner-overlay">
    <div>
        <div class="spinner"></div>
        <div class="spinner-text">Processing, please wait...</div>
    </div>
</div>

<!-- Modal for quota limit -->
<div id="limit-modal" class="modal-overlay" th:data-show="${showLimitModal}" style="display:none;">
    <div class="modal-content">
        <span id="close-modal-btn" class="modal-close">&times;</span>
        <h3 class="modal-title">Limit Reached</h3>
        <p class="modal-message" th:text="${error}">You have used your free quota. Please upgrade.</p>
        <form method="post" action="/api/payment/create-checkout-session">
            <button type="submit" class="pay-btn">Upgrade Now</button>
        </form>
    </div>
</div>

<footer class="footer-links">
    <a href="/terms">Terms</a> |
    <a href="/privacy">Privacy Policy</a> |
    <a href="/disclaimer">Disclaimer</a> |
    <a href="/contact">Contact</a>
</footer>
</body>
</html>